article#article(x-ref='article' class='prose dark:prose-invert max-w-none')
  | #{`[##_${type}_rep_desc_##]`}
  include PostBtn/Subscription

style(once='article')
  :postcss
    #article {
      .contents_style {
        @apply text-left p-0 leading-loose text-h-600 dark:text-h-200;

        a {
          @apply text-h-orange dark:text-h-blue decoration-0;
        }

        h2,
        h3,
        h4 {
          @apply my-5 font-medium scroll-mt-20;

          a {
            @apply text-h-600 dark:text-h-200;
          }
        }

        h2 {
          @apply text-xl lg:text-2xl;
        }

        h3 {
          @apply text-lg lg:text-xl;
        }

        h4 {
          @apply text-base lg:text-lg;
        }

        ol[data-ke-list-type] {
          @apply flex flex-col gap-y-3 pl-0 my-5;
          list-style: none !important;
          counter-reset: step-counter;
          
          > li {
            @apply relative pl-10;
            list-style: none !important;
            counter-increment: step-counter;
            
            &::before {
              @apply absolute left-0 top-0.5 w-6 h-6 rounded-full text-xs font-bold flex items-center justify-center;
              @apply bg-h-blue text-h-100;
              content: counter(step-counter);
            }
          }
          
          ol[data-ke-list-type] {
            @apply my-2 ml-0;
            counter-reset: nested-counter;
            
            > li {
              counter-increment: nested-counter;
              
              &::before {
                @apply bg-h-300 dark:bg-h-600 text-h-600 dark:text-h-200 w-5 h-5 text-2xs;
                content: counter(nested-counter);
              }
            }
          }
        }
        
        ul[data-ke-list-type] {
          @apply flex flex-col gap-y-1 pl-[1.1rem] my-5;

          ul[data-ke-list-type] {
            @apply my-0 ml-6;
          }
        }

        p,
        ol[data-ke-list-type],
        ul[data-ke-list-type],
        table[data-ke-align],
        blockquote[data-ke-style=style2],
        blockquote[data-ke-style=style3] {
          @apply text-h-600 dark:text-h-300;

          b,
          strong {
            @apply font-bold;
          }

          a {
            @apply inline-block text-h-orange dark:text-h-blue;
          }

          code:not(:where(pre *)) {
            @apply rounded-md relative -top-[1px] px-1.5 py-0.5 whitespace-normal text-sm font-sans text-h-orange bg-h-200;
            @apply dark:text-h-blue dark:bg-h-700;
          }
        }

        figure,
        pre,
        table[data-ke-align],
        [data-ke-type=moreLess] {
          @apply my-5;
        }

        hr[data-ke-style] {
          @apply dark:invert dark:brightness-0;
        }

        table[data-ke-align] {
          td,
          th {
            @apply bg-transparent border-0 border-b border-solid border-h-300 px-3 py-4 box-border text-sm leading-loose text-h-600;
            @apply dark:text-h-200 dark:border-h-600;

            figure {
              &.imageblock.alignCenter {
                @apply w-full !important;
              }
            }
          }
        }

        figure {
          figcaption {
            @apply text-h-400 text-center text-sm leading-loose;
          }

          &.imageblock.alignCenter,
          &.imagegridblock {
            @apply max-lg:w-full !important;
          }

          &[data-ke-type=opengraph] {
            a {
              @apply border-0;

              .og-image {
                @apply border-r-0 rounded-l-md overflow-hidden;
              }
            }

            .og-text {
              @apply bg-h-200 dark:bg-h-700 rounded-r-md;

              .og-title,
              .og-desc,
              .og-host {
                @apply text-h-500 dark:text-h-200 font-sans;
              }

              .og-title {
                @apply text-h-600 font-bold;
              }
            }
          }

          &.fileblock {
            @apply border-0 bg-h-200 dark:bg-h-700;

            .filename {
              @apply mt-3;

              .name {
                @apply h-auto;
              }
            }

            .filename,
            .size {
              @apply dark:text-h-200;
            }

            .image,
            a::after {
              @apply dark:invert dark:brightness-0;
            }
          }
        }

        [data-ke-type=moreLess] {
          @apply relative;

          &::before {
            @apply content-[''] absolute top-4 right-0 w-full h-0 w-full -z-[1] border-b border-dashed border-h-300 dark:border-h-600;
          }

          &.open {
            .btn-toggle-moreless::before {
              @apply fa-circle-arrow-down;
            }
          }

          .btn-toggle-moreless {
            @apply bg-h-700 text-h-200 text-xs font-bold rounded-md px-3 py-2 inline-block !important;

            &::before {
              @apply mr-1.5 fa-circle-arrow-right;
            }
          }

          .moreless-content {
            @apply mt-6;
          }
        }

        blockquote[data-ke-style] {
          @apply font-[initial] my-4 text-h-600 dark:text-h-200 font-sans;

          &[data-ke-style=style1] {
            @apply font-medium text-xl pt-7 leading-loose text-h-600 dark:text-h-200;
          }

          &[data-ke-style=style2] {
            @apply border-l-2 border-solid border-h-300 dark:border-h-600 pl-3 pr-1 text-h-400 text-left text-sm leading-loose;
          }

          &[data-ke-style=style3] {
            @apply p-5 rounded-md border-0 text-h-400 bg-h-200 dark:bg-h-700 dark:text-h-400 leading-loose;
          }
        }

        /* GitHub 스타일 Alerts - 사용법: <div class="alert alert-note">내용</div> */
        .alert {
          @apply p-4 my-5 rounded-md border-l-4 text-sm leading-relaxed;
          
          .alert-title {
            @apply flex items-center gap-2 font-bold mb-2;
            
            i {
              @apply text-base leading-none;
            }
          }
          
          p {
            @apply m-0;
          }
          
          a {
            text-decoration: underline;
          }
          
          code {
            @apply px-1.5 py-0.5 rounded text-xs;
          }
          
          /* NOTE - 파란색 */
          &.alert-note {
            background-color: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            color: #1e40af;
            
            .alert-title {
              color: #3b82f6;
              
              i { color: #3b82f6; }
            }
            
            code {
              background-color: rgba(59, 130, 246, 0.2);
              color: #1e40af;
            }
          }
          
          /* TIP - 초록색 */
          &.alert-tip {
            background-color: rgba(34, 197, 94, 0.1);
            border-color: #22c55e;
            color: #166534;
            
            .alert-title {
              color: #22c55e;
              
              i { color: #22c55e; }
            }
            
            code {
              background-color: rgba(34, 197, 94, 0.2);
              color: #166534;
            }
          }
          
          /* IMPORTANT - 보라색 */
          &.alert-important {
            background-color: rgba(168, 85, 247, 0.1);
            border-color: #a855f7;
            color: #6b21a8;
            
            .alert-title {
              color: #a855f7;
              
              i { color: #a855f7; }
            }
            
            code {
              background-color: rgba(168, 85, 247, 0.2);
              color: #6b21a8;
            }
          }
          
          /* WARNING - 노란색 */
          &.alert-warning {
            background-color: rgba(234, 179, 8, 0.1);
            border-color: #eab308;
            color: #854d0e;
            
            .alert-title {
              color: #eab308;
              
              i { color: #eab308; }
            }
            
            code {
              background-color: rgba(234, 179, 8, 0.2);
              color: #854d0e;
            }
          }
          
          /* CAUTION - 빨간색 */
          &.alert-caution {
            background-color: rgba(239, 68, 68, 0.1);
            border-color: #ef4444;
            color: #991b1b;
            
            .alert-title {
              color: #ef4444;
              
              i { color: #ef4444; }
            }
            
            code {
              background-color: rgba(239, 68, 68, 0.2);
              color: #991b1b;
            }
          }
        }

        pre {
          code {
            @apply rounded-md p-4 text-sm leading-relaxed;

            &.hljs {
              @apply bg-h-200 dark:bg-h-700;
            }
          }
        }
      }
    }

style(once='article-postbtn')
  :postcss
    #article {
      .container_postbtn {
        @apply flex gap-x-2 p-0 pt-9 text-h-600 dark:text-h-200;

        .postbtn_like > .wrap_btn:not([id^=reaction-]) > button,
        .btn_subscription,
        .tt-btn-support {
          @apply w-9 h-9 inline-block shadow-none outline-0 rounded-md cursor-pointer duration-200 leading-none text-[0] p-0 m-0 bg-h-200 border-0 hover:bg-h-300 before:text-h-500;
          @apply dark:bg-h-700 dark:before:text-h-200 dark:hover:bg-h-600;
        }

        .postbtn_like {
          @apply border-0 p-0 flex gap-x-2;

          .wrap_btn {
            @apply inline-block border-0;

            button,
            button[data-entry-id],
            .uoc-count {
              &::before {
                @apply font-bold text-sm;
              }
            }

            .ico_like,
            .ico_share,
            .ico_statistics,
            .ico_etc {
              @apply text-hidden bg-none;
            }

            &[id^=reaction-] button {
              @apply px-3 h-9 rounded-md bg-h-700 hover:bg-h-600;

              .uoc-icon {
                @apply text-h-200;
              }

              .uoc-count {
                @apply font-bold leading-none;

                &::before {
                  @apply text-sm mr-1.5 fa-heart;
                }
              }
            }

            &.wrap_btn_share .btn_share::before {
              @apply fa-share-nodes;
            }

            button[data-entry-id] {
              &::before {
                @apply fa-chart-pie;
              }
            }

          }

          /* 비로그인 상태에서 관리 버튼 숨김 (티스토리가 로그인 시에만 표시) */
          &.wrap_btn_etc {
            @apply hidden;

            .btn_etc1::before {
              @apply fa-wrench;
            }

            .btn_etc2::before {
              @apply fa-ellipsis;
            }
          }
        }

        /* 티스토리 기본 구독 버튼 숨김 (커스텀 버튼만 사용) */
        > .btn_subscription:not([data-teleport-target]) {
          @apply hidden;
        }

        /* 서포트 버튼 숨김 */
        [data-tistory-react-app="SupportButton"] {
          @apply hidden;
        }
        }
      }
    }

style(once='article-tistory-ccl-layer')
  :postcss
    #tistoryCclLayer {
      @apply shadow-none border-0 bg-h-200 text-h-400 rounded-md;
      @apply dark:bg-h-700 dark:text-h-300;

      span {
        @apply text-h-400;
      }

      .ico_arrbt {
        @apply hidden;
      }
    }

style(once='article-tistory-layer')
  :postcss
    #tistorySnsLayer,
    #tistoryEtcLayer {
      @apply rounded-md shadow-none bg-h-200;
      @apply dark:bg-h-700;

      .btn_mark {
        @apply text-h-400 dark:text-h-300;

        &:hover {
          @apply bg-h-300 dark:bg-h-600 dark:text-h-200;
        }
      }

      .ico_arrbt {
        @apply hidden;
      }

      .bundle_post a {
        @apply text-h-400 dark:text-h-300 no-underline;
      }
    }

script(once='github-alerts').
  // GitHub 스타일 Alerts 자동 변환
  // blockquote 또는 p에 [!NOTE], [!TIP], [!IMPORTANT], [!WARNING], [!CAUTION]으로 시작하면 자동 변환
  document.addEventListener('DOMContentLoaded', function() {
    const alertTypes = {
      'NOTE': { class: 'alert-note', title: 'NOTE', icon: 'fa-circle-info' },
      'TIP': { class: 'alert-tip', title: 'TIP', icon: 'fa-lightbulb' },
      'IMPORTANT': { class: 'alert-important', title: 'IMPORTANT', icon: 'fa-circle-exclamation' },
      'WARNING': { class: 'alert-warning', title: 'WARNING', icon: 'fa-triangle-exclamation' },
      'CAUTION': { class: 'alert-caution', title: 'CAUTION', icon: 'fa-octagon-xmark' }
    };
    
    const contentArea = document.querySelector('.contents_style');
    if (!contentArea) return;
    
    // 변환 함수
    function convertToAlert(element) {
      const text = element.textContent.trim();
      const match = text.match(/^\[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]/i);
      
      if (match) {
        const type = match[1].toUpperCase();
        const config = alertTypes[type];
        
        // Alert div 생성
        const alertDiv = document.createElement('div');
        alertDiv.className = 'alert ' + config.class;
        
        // 제목 생성
        const titleP = document.createElement('p');
        titleP.className = 'alert-title';
        titleP.innerHTML = '<i class="fa-solid ' + config.icon + '"></i> ' + config.title;
        alertDiv.appendChild(titleP);
        
        // 내용 처리 - [!TYPE] 제거 후 나머지 내용 (br 태그 유지)
        let contentHtml = element.innerHTML;
        contentHtml = contentHtml.replace(/^\[!(NOTE|TIP|IMPORTANT|WARNING|CAUTION)\]\s*(<br\s*\/?>)?/i, '');
        if (contentHtml.trim()) {
          const contentP = document.createElement('p');
          contentP.innerHTML = contentHtml;
          alertDiv.appendChild(contentP);
        }
        
        // 원본 요소를 alert div로 교체
        element.parentNode.replaceChild(alertDiv, element);
        return true;
      }
      return false;
    }
    
    // blockquote 처리
    contentArea.querySelectorAll('blockquote').forEach(convertToAlert);
    
    // p 태그 처리 (직접 자식만)
    contentArea.querySelectorAll('p').forEach(convertToAlert);
  });
